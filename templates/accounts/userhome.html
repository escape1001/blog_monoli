{% extends "base/base.html" %}
{% load static %}
{% block content %}
<main class="userhome-wrapper center-content">
    <h2 class="section-title">{{profile.nickname}}ì˜ ë¸”ë¡œê·¸</h2>
    {% if request.user == author %}
    <section class="recommend-area hidden">
        <h3 class="ir-hidden">ê¸€ê° ì¶”ì²œ</h3>
        <form action="{% url "post_create" %}" method="POST">
            {% csrf_token %}
            <textarea name="recommend" readonly>
            </textarea>
            <button class="default-btn reverse">ê¸€ ì“°ëŸ¬ ê°€ê¸°</button>
        </form>
    </section>
    {% endif %}
    <div class="flex-area">
        <section class="profile-area">
            <h3 class="ir-hidden">ìœ ì € í”„ë¡œí•„</h3>
            <div class="">
                {% if profile.profile_image %}
                <img class="profile-image" src="{{profile.profile_image.url}}" alt="{{profile.nickname}}ì˜ í”„ë¡œí•„ ì´ë¯¸ì§€">
                {% else %}
                <img class="profile-image" src="{% static "assets/default_profile.png" %}">
                {% endif %}
                <div class="text-area">
                    <p>
                        {{profile.nickname}}
                    </p>
                    <p>
                        {{profile.introduce}}
                    </p>
                </div>
            </div>
        </section>
        <section class="post-area">
            <h3 class="ir-hidden">{{profile.nickname}}ì˜ í¬ìŠ¤íŠ¸</h3>
            <ul class="post-list">
                {% for post in posts %}
                <li class="box3">
                    <a href="{% url "post_detail" post.pk %}">
                        {% if post.thumbnail_image %}
                        <img src="{{post.thumbnail_image.url}}" alt="">
                        {% endif %}
                        <div class="content-box">
                            <div class="title-area">
                                <b class="title">{{post.title}}</b>
                                <ul>
                                    <li>
                                        <img src="{% static "assets/icon_view.svg" %}" alt="view">
                                        {{post.view_count}}
                                    </li>
                                    <li>
                                        <img src="{% static "assets/icon_comment.svg" %}" alt="comment">
                                        {{post.comments.count}}
                                    </li>
                                    <li>
                                        <img src="{% static "assets/icon_liked.svg" %}" alt="liked">
                                        {{post.likes.count}}
                                    </li>
                                </ul>
                            </div>
                            <ul class="tag-list">
                                {% for tag in post.tags.all %}
                                <li>{{tag.name}}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="info-box">
                            <p>by. {{post.author}}</p>
                            <p>{{post.created_at|date:"Y-m-d"}}</p>
                        </div>
                    </a>
                </li>
                {% endfor %}
                {% if not posts %}
                <li class="empty">
                    ì•„ì§ ì‘ì„±í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
                </li>
                {% endif %}
            </ul>
        </section>
    </div>
</main>
<script>
    const url = "https://open-api.jejucodingcamp.workers.dev/chat";
    const username = "{{profile.nickname}}";
    const recommend_area = document.querySelector(".recommend-area");
    const recommend_textarea = document.querySelector(".recommend-area textarea");

    const setRecommend = (content) => {
        recommend_textarea.value = "ğŸ€ "+ content;
        recommend_area.classList.remove("hidden");
    };

    const sendRequest = async(data) => {    
        try{
            const res = await fetch(url,{
                method:"POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            });
    
            if (!res.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
    
            const answer = await res.json();
            const content = answer.choices[0].message.content;
            setRecommend(content);
        } catch(error){
            console.error(error);
        }
    };

    if (recommend_area){
        const data = [
            {
                "role": "system",
                "content": `
                    ë„ˆëŠ” ë¸”ë¡œê·¸ í¬ìŠ¤íŒ… ì£¼ì œë¥¼ ì¶”ì²œí•˜ëŠ” ë´‡ì´ì•¼. ìƒëƒ¥í•œ ë§íˆ¬ë¥¼ ê°€ì¡Œê³  ì´ë¦„ì€ 'ë¸”ë¡œê·¸ì”¨'ì•¼.
                    ë‹µë³€ ë¬¸ì¥ì€ í•­ìƒ 3ë¬¸ì¥ ì´ë‚´ë¡œ, ê° ë¬¸ì¥ì€ ì¤„ ë„ì›€ìœ¼ë¡œ êµ¬ë¶„í•´ì¤˜.
                    ëŒ€í™”ëŠ” í•œë²ˆ ì´ìƒ ì´ì–´ì§€ì§€ ì•Šì„ ê±°ì•¼. ë‹µë³€ì€ 3ë¬¸ì¥ ì•ˆì—ì„œ ëë‚´ì¤˜.
                    <ë‹µë³€ì˜ˆì‹œ>ë¥¼ ì°¸ì¡°í•˜ë˜ ê°™ì€ ë‚´ìš©ì„ ì¶œë ¥í•´ì„œëŠ” ì•ˆë¼.
                    ë§Œì•½ ì²˜ìŒ ë‚´ë†“ì€ ë‹µë³€ì´ <í‹€ë¦°ë‹µë³€ì˜ˆì‹œ>ì™€ ê°™ì€ ë‚´ìš©ì¼ ê²½ìš° ë‹¤ì‹œ ê³ ë¯¼í•´ì¤˜.
                    ë„¤ê°€ ì°¸ì¡°í•  ë³€ìˆ˜ë“¤ì€ ì•„ë˜ì™€ ê°™ì•„.

                    <ì¹´í…Œê³ ë¦¬>ì·¨ë¯¸, ì—¬í–‰, IT, ìŒì‹, ì‹ë¬¼, ë™ë¬¼</ì¹´í…Œê³ ë¦¬>

                    <ë‹µë³€ì˜ˆì‹œ>
                    ì•ˆë…•í•˜ì„¸ìš” 000ë‹˜! ë¸”ë¡œê·¸ì”¨ì˜ ìƒˆë¡œìš´ ì·¨ë¯¸ëŠ” ë‹¤ê¾¸ëë‹ˆë‹¤~ ì·¨ë¯¸ ë¶€ìì¸ ë‚´ê°€ í•˜ëŠ” ì·¨ë¯¸ë“¤ì„ ì‚¬ì§„ê³¼ í•¨ê»˜ ê³µìœ í•´ì£¼ì„¸ìš”~
                    </ë‹µë³€ì˜ˆì‹œ>

                    <í‹€ë¦°ë‹µë³€ì˜ˆì‹œ>
                    ë¸”ë¡œê·¸ì”¨ì˜ ìƒˆë¡œìš´ ì—¬í–‰ì§€ ì¶”ì²œ í¬ìŠ¤íŒ…ì´ ì–´ë– ì„¸ìš”? ì„¸ê³„ ê°ì§€ì˜ ë©‹ì§„ ì—¬í–‰ì§€ë¥¼ ì†Œê°œí•´ë“œë¦´ê²Œìš”~ í•¨ê»˜ ê¿ˆë‚˜ë¼ ì—¬í–‰ì„ ë– ë‚˜ë³´ì„¸ìš”!

                    í‹€ë¦° ì´ìœ  : ì„¸ê³„ ê°ì§€ì˜ ë©‹ì§„ ì—¬í–‰ì§€ë¥¼ ì†Œê°œí•´ì¤€ë‹¤ê³  í–ˆìœ¼ë‚˜ ì‹¤ì œë¡œ êµ¬ì²´ì ì¸ ì—¬í–‰ì§€ë¥¼ ì œì‹œí•˜ì§„ ì•Šì•˜ìŒ.
                    </í‹€ë¦°ë‹µë³€ì˜ˆì‹œ>
                `
            },
            {
                "role" : "assistant",
                "content" : `ì•ˆë…•í•˜ì„¸ìš” ${username}ë‹˜!`
            },
            {
                "role": "user",
                "content": `
                    <ì¹´í…Œê³ ë¦¬>ì¤‘ì—ì„œ ëœë¤í•˜ê²Œ ì£¼ì œ í•˜ë‚˜ë¥¼ ê³ ë¥´ê³  <ì‚¬ìš©ìì´ë¦„>ì„ ì°¸ì¡°í•´ì„œ ë‹µë³€ì„ ë°˜í™˜í•´ì¤˜.

                    <ì‚¬ìš©ìì´ë¦„>${username}</ì‚¬ìš©ìì´ë¦„>
                `
            }
        ];

        sendRequest(data);
    }
</script>
{% endblock %}